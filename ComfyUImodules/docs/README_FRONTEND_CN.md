# ComfyUI 图像生成 - 前端使用指南（面向用户）

本指南帮助你在 VCPChat 中使用“AI图（ComfyUI 图像生成）”功能，完成连接设置、参数配置、工作流管理与导入。无需了解内部实现。

如果你是开发者并想了解工作流自动替换、无前端接入等后端流程，请查看后端文档：VCPToolBox/Plugin/ComfyUIGen/docs/README_PLUGIN_CN.md

--------------------------------

## 一、功能概览

- 连接 ComfyUI 服务（默认 http://localhost:8188）
- 设置默认生成参数（模型、尺寸、采样器、步数、CFG、随机种子、去噪、负面提示词等）
- 管理 LoRA（添加、强度设置、启用/禁用）
- 管理工作流（查看、编辑、新建、删除、导入 API JSON 并转换为模板）
- 实时同步：保存配置或外部修改配置文件后，界面会自动更新

你只要完成“连接 → 设置参数 → 选择工作流”，即可开始让 Agent 或集成应用进行图像生成。

--------------------------------

## 二、快速开始

1) 打开配置面板
- 在应用右侧通知区域，点击“AI图”按钮，打开“ComfyUI 图像生成配置”面板。

2) 连接 ComfyUI
- 进入“连接设置”标签页
- 填入 ComfyUI 服务器地址（默认 http://localhost:8188）
- 点击“测试连接”
- 成功后会显示“已连接”，并自动加载模型与 LoRA 列表

3) 配置生成参数
- 进入“生成参数”标签页
- 选择“工作流模板”（如：text2img_basic）
- 选择“默认模型”，设置“宽/高、步数、CFG、采样器、调度器、种子、数量、去噪”
- 可使用“快速尺寸预设”一键设置常用分辨率

4) 提示词与 LoRA
- 进入“提示词配置”标签页
- 质量增强词（会自动加入提示词）与默认“负面提示词”可在这里填写
- 点击“+ 添加 LoRA”从服务器可用 LoRA 列表中选择，并设置“模型强度/CLIP强度”，可多项叠加

5) 工作流管理（可选）
- 进入“工作流管理”标签页
- 可查看/编辑现有工作流；“内置工作流”不可删除
- “添加新工作流”支持基于基础模板或空白创建

6) 导入外部工作流（可选）
- 进入“导入工作流”标签页
- 将 ComfyUI 中“Save (API Format)”导出的 JSON 粘贴到“工作流JSON”
- 填写“工作流名称”后，点击“验证格式”与“转换并保存”
- 成功后会出现在“工作流管理”列表中

7) 保存
- 面板右下角点击“保存配置”
- 配置会被保存并立即生效，后续由 Agent 或集成应用读取并执行

--------------------------------

## 三、各项参数说明

- 工作流模板：决定使用哪套 ComfyUI 节点流程（如 文生图/图生图 基础模板）
- 默认模型：选择可用的 checkpoint 模型（连接成功后自动加载）
- 尺寸：宽度/高度（可选择预设，如 1024×1024）
- 采样步数（Steps）：数值越大细节越多，但耗时更长
- CFG：提示词遵循程度，过高可能造成不自然
- 采样器/调度器：不同采样策略，会影响速度与效果
- 种子：-1 表示随机；固定种子可复现相同结果
- 去噪强度（Denoise）：在图生图场景中常用，控制改变幅度
- 质量增强词：自动拼接在正面提示词，提升画质
- 负面提示词：告诉模型应该避免的内容
- LoRA：可选择多个 LoRA 叠加，并分别设置强度

--------------------------------

## 四、常见问题（FAQ）

1) “测试连接”失败怎么办？
- 检查 ComfyUI 是否已启动，以及地址端口是否正确
- 若需要鉴权，请在“API Key”处填写
- 本地防火墙或代理可能阻止连接

2) 模型/LoRA列表为空？
- 需要先“测试连接”成功，界面才会从 ComfyUI 读取可用项
- 确保 ComfyUI 端已正确安装模型/LoRA

3) 工作流导入失败？
- 确认是从 ComfyUI 界面使用“Save (API Format)”导出
- 先“验证格式”，根据提示修正后再“转换并保存”

4) 保存后界面未更新？
- 一般会自动更新；若未刷新，关闭后重新打开配置面板
- 请确认写入路径权限正常

--------------------------------

## 五、注意事项与建议

- 建议先在小分辨率下调参，满意后再提升尺寸与步数
- LoRA 叠加过多或强度过高可能导致画面失真
- 固定“随机种子”有助于复现结果；发布场景建议使用随机提升多样性
- 导入工作流后可在“工作流管理”中查看并微调

--------------------------------

## 六、无界面使用（给非技术用户的简述）

即使不打开这个配置面板，也可以通过修改一个配置文件来控制生图参数：
- 配置文件位置：VCPToolBox/Plugin/ComfyUIGen/comfyui-settings.json
- 只要修改里面的字段（如“workflow”、“默认模型”、“宽高”、“负面词”等），后续生成就会使用你的设置
- 详细字段说明请看后端文档：VCPToolBox/Plugin/ComfyUIGen/docs/README_PLUGIN_CN.md

祝你使用愉快！